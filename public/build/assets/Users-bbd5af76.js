import{b as l,c as b,a as c,F as A,j as e}from"./app-8b4d67ed.js";import{I as u,a as d,B as m}from"./app-6e989420.js";import{u as v,C as O}from"./useFormValidation-cc0a12dd.js";import{D as T,a as V,b as y}from"./rating.esm-a774aaa2.js";import{a as k,C as z,D as $,c as L}from"./toast.esm-b519671e.js";const G=()=>{const o=l.useRef(null),[_,p]=l.useState(!1),[g,w]=l.useState(),[N,U]=l.useState(),[h,f]=l.useState([]),[i,C]=l.useState({first:0,rows:50,page:0}),a=v({name:"",email:"",password:""},{name:"required|string",email:"required|email",password:"required|string|min:8"},S),t=v({name:"",email:""},{name:"required|string",email:"required|email"},B);function S(){b.post("/dashboard/users",a.state).then(({data:s})=>{a.clearValues(!0),a.updateIsSubmitting(!1),o.current.show({severity:"success",summary:"Users added successfully",life:3e3});const r=h.length<i.rows?[s.data,...h]:[s.data,...[].concat(h.pop())];f(r)}).catch(s=>{a.updateIsSubmitting(!1),s.response?s.response.status===422?a.setServerErrors(s.response.data.errors):s.response.status===500?o.current.show({severity:"error",summary:"Ooops! Something went wrong, please refresh and try again.",life:3e3}):console.trace(s):console.trace(s)})}function B(){b.put(`/dashboard/users/${g.id}`,t.state).then(({data:s})=>{t.updateIsSubmitting(!1),o.current.show({severity:"success",summary:"User updated successfully",life:3e3}),f(r=>r.map(n=>n.id===s.data.id?s.data:n)),p(!1)}).catch(s=>{t.updateIsSubmitting(!1),s.response?s.response.status===422?t.setServerErrors(s.response.data.errors):s.response.status===500?o.current.show({severity:"error",summary:"Ooops! Something went wrong, please refresh and try again.",life:3e3}):console.trace(s):console.trace(s)})}const D=(s,r)=>{L({target:s.currentTarget,message:"Do you want to delete this user?",icon:"pi pi-trash",acceptClassName:"p-button-danger",accept:()=>{b.delete(`/dashboard/users/${r}`).then(({data:n})=>{o.current.show({severity:"success",summary:"User deleted successfully",life:3e3}),f(j=>j.filter(q=>q.id!==r))}).catch(n=>{n.response&&n.response.status===500?o.current.show({severity:"error",summary:"Ooops! Something went wrong, please refresh and try again.",life:3e3}):console.trace(n)})}})},x=s=>{t.setValues({name:s.name,email:s.email}),w(s),p(!0)},F=s=>{C(s)},E=()=>c("div",{className:"table__header",children:[e("div",{className:"table__header__search",children:c("span",{className:"p-input-icon-left",children:[e("i",{className:"pi pi-search"}),e(d,{placeholder:"Search users..."})]})}),e("div",{className:"table__header__buttons",children:e(m,{label:"New User",type:"button",icon:"pi pi-plus",className:"p-button-primary",onClick:()=>p(!0)})})]}),I=s=>c("div",{children:[e(m,{type:"button",icon:"pi pi-pencil",tooltip:"Edit User",tooltipOptions:{position:"top"},className:"p-button-text p-button-secondary p-button-sm",onClick:()=>x(s)}),e(m,{type:"button",icon:"pi pi-trash",tooltip:"Delete User",tooltipOptions:{position:"top"},className:"p-button-text p-button-danger p-button-sm",onClick:r=>D(r,s.id)})]}),P=l.useCallback(async()=>{b.get(`/dashboard/users/all?offset=${i.first}&limit=${i.rows}`).then(({data:s})=>{if(s.status){const r=s.data;U(r.count),f(r.records)}}).catch(s=>{console.trace(`Could not fetch data: 
`,s)})},[i]);return l.useEffect(()=>{P()},[i]),c(A,{children:[e(k,{ref:o}),e(z,{}),e(T,{page:"Users",children:e(O,{children:c(V,{value:h,first:i.first,rows:i.rows,totalRecords:N,onPage:F,paginator:!0,lazy:!0,dataKey:"id",header:E,className:"mt-6",responsiveLayout:"scroll",emptyMessage:"No user found.",children:[e(y,{header:"Name",field:"name"}),e(y,{header:"Email",field:"email"}),e(y,{header:"Actions",body:I})]})})}),e($,{header:g?"Update User":"Add New User",visible:_,style:{width:"50%"},onHide:()=>{p(!1),a.clearValues(),t.clearValues(),w()},children:g?c("form",{onSubmit:t.handleSubmit,children:[e("div",{className:"s__row",children:e("div",{className:"s__col c--12",children:e(u,{label:"Name",name:"name",errors:t.errors,children:e(d,{name:"name",value:t.state.name,onBlur:t.handleBlur,onChange:t.handleChange})})})}),e("div",{className:"s__row",children:e("div",{className:"s__col c--12",children:e(u,{label:"Email",name:"email",errors:t.errors,children:e(d,{type:"email",name:"email",value:t.state.email,onBlur:t.handleBlur,onChange:t.handleChange})})})}),e("div",{className:"flex justify-end mt-6",children:e(m,{type:"submit",label:"Update",loading:a.isSubmitting,disabled:a.isSubmitting})})]}):c("form",{onSubmit:a.handleSubmit,children:[e("div",{className:"s__row",children:e("div",{className:"s__col c--12",children:e(u,{label:"Name",name:"name",errors:a.errors,children:e(d,{name:"name",value:a.state.name,onBlur:a.handleBlur,onChange:a.handleChange})})})}),e("div",{className:"s__row",children:e("div",{className:"s__col c--12",children:e(u,{label:"Email",name:"email",errors:a.errors,children:e(d,{type:"email",name:"email",value:a.state.email,onBlur:a.handleBlur,onChange:a.handleChange})})})}),e("div",{className:"s__row",children:e("div",{className:"s__col c--12",children:e(u,{label:"Password",name:"password",errors:a.errors,children:e(d,{type:"password",name:"password",value:a.state.password,onBlur:a.handleBlur,onChange:a.handleChange})})})}),e("div",{className:"flex justify-end mt-6",children:e(m,{type:"submit",label:"Add",loading:a.isSubmitting,disabled:a.isSubmitting})})]})})]})};export{G as default};
