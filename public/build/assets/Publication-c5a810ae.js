import{b as d,c as _,a as o,F as V,j as e}from"./app-16b6fe95.js";import{I as n,a as u,B as p}from"./theme-5066fd95.js";import{I as w,C}from"./inputtextarea.esm-7f86ad25.js";import{a as E,C as L,b as U,D as H,c as K}from"./toast.esm-dfa48580.js";import{D as M,a as W,b as h}from"./rating.esm-e63fb966.js";import{u as N}from"./useFormValidation-31419ef4.js";import{f as G}from"./helpers-16255e8b.js";const te=()=>{const l=d.useRef(null),[P,m]=d.useState(!1),[y,v]=d.useState(),[S,D]=d.useState(),[b,f]=d.useState([]),[c,B]=d.useState({first:0,rows:50,page:0}),s=N({title:"",pdf:null,image:null,description:"",published_date:""},{title:"required",pdf:"required",image:"required",description:"",published_date:"required"},F),t=N({title:"",pdf:null,image:null,description:"",published_date:""},{title:"required",pdf:"",image:"",description:"",published_date:"required"},T);function F(){const a=new FormData;a.append("title",s.state.title),a.append("pdf",s.state.pdf[0]),a.append("description",s.state.description),a.append("published_date",s.state.published_date),a.append("image",s.state.image[0]),_.post("/dashboard/publications",a,{headers:{"Content-Type":"multipart/form-data"}}).then(({data:i})=>{s.clearValues(!0),s.updateIsSubmitting(!1),l.current.show({severity:"success",summary:"Publication added successfully",life:3e3});const r=b.length<c.rows?[i.data,...b]:[i.data,...[].concat(b.pop())];f(r)}).catch(i=>{s.updateIsSubmitting(!1),i.response?i.response.status===422?s.setServerErrors(i.response.data.errors):i.response.status===413?l.current.show({severity:"error",summary:"Files to large",life:3e3}):i.response.status===500?l.current.show({severity:"error",summary:"Ooops! Something went wrong, please refresh and try again.",life:3e3}):console.trace(i):console.trace(i)})}function T(){const a=new FormData;a.append("title",t.state.title),a.append("pdf",t.state.pdf?t.state.pdf[0]:t.state.pdf),a.append("description",t.state.description),a.append("published_date",t.state.published_date),a.append("image",t.state.image?t.state.image[0]:t.state.image),_.post(`/dashboard/publications/${y.id}`,a,{headers:{"Content-Type":"multipart/form-data"}}).then(({data:i})=>{t.updateIsSubmitting(!1),l.current.show({severity:"success",summary:"Publication updated successfully",life:3e3}),f(r=>r.map(g=>g.id===i.data.id?i.data:g)),m(!1)}).catch(i=>{t.updateIsSubmitting(!1),i.response?i.response.status===422?t.setServerErrors(i.response.data.errors):i.response.status===413?l.current.show({severity:"error",summary:"Files to large",life:3e3}):i.response.status===500?l.current.show({severity:"error",summary:"Ooops! Something went wrong, please refresh and try again.",life:3e3}):console.trace(i):console.trace(i)})}const x=(a,i)=>{K({target:a.currentTarget,message:"Do you want to delete this publication?",icon:"pi pi-trash",acceptClassName:"p-button-danger",accept:()=>{_.delete(`/dashboard/publications/${i}`).then(({data:r})=>{l.current.show({severity:"success",summary:"Publication deleted successfully",life:3e3}),f(g=>g.filter(R=>R.id!==i))}).catch(r=>{r.response?r.response.status===413?l.current.show({severity:"error",summary:"Files to large",life:3e3}):r.response.status===500?l.current.show({severity:"error",summary:"Ooops! Something went wrong, please refresh and try again.",life:3e3}):console.trace(r):console.trace(r)})}})},I=a=>{t.setValues({title:a.title,pdf:null,image:null,description:a.description,published_date:new Date(a.published_date)}),v(a),m(!0)},q=a=>{B(a)},z=()=>o("div",{className:"table__header",children:[e("div",{className:"table__header__search",children:o("span",{className:"p-input-icon-left",children:[e("i",{className:"pi pi-search"}),e(u,{placeholder:"Search publications..."})]})}),e("div",{className:"table__header__buttons",children:e(p,{label:"New Publication",type:"button",icon:"pi pi-plus",className:"p-button-primary",onClick:()=>m(!0)})})]}),A=a=>e("span",{children:G(a.published_date)}),O=a=>e("div",{style:{height:"6rem",overflow:"hidden"},children:e("img",{src:`/uploads/publications/images/${a.image}`,alt:a.title,style:{width:"12rem",height:"6rem"}})}),$=a=>e("a",{href:`/uploads/publications/pdf/${a.pdf}`,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"underline"},children:a.title}),j=a=>o("div",{children:[e(p,{type:"button",icon:"pi pi-pencil",tooltip:"Edit Publication ",tooltipOptions:{position:"top"},className:"p-button-text p-button-secondary p-button-sm",onClick:()=>I(a)}),e(p,{type:"button",icon:"pi pi-trash",tooltip:"Delete Publication",tooltipOptions:{position:"top"},className:"p-button-text p-button-danger p-button-sm",onClick:i=>x(i,a.id)})]}),k=d.useCallback(async()=>{_.get(`/dashboard/publications/all?offset=${c.first}&limit=${c.rows}`).then(({data:a})=>{if(a.status){const i=a.data;D(i.count),f(i.records)}}).catch(a=>{console.trace(`Could not fetch data: 
`,a)})},[c]);return d.useEffect(()=>{k()},[c]),o(V,{children:[e(E,{ref:l}),e(L,{}),e(M,{page:"Publications",children:e(U,{children:o(W,{value:b,first:c.first,rows:c.rows,totalRecords:S,onPage:q,paginator:!0,lazy:!0,dataKey:"id",header:z,className:"mt-6",responsiveLayout:"scroll",emptyMessage:"No publication found.",children:[e(h,{header:"Banner",body:O}),e(h,{header:"Title",body:$}),e(h,{header:"Description",field:"description",bodyStyle:{width:"40rem"}}),e(h,{header:"Published On",body:A}),e(h,{header:"Actions",body:j})]})})}),e(H,{header:y?"Update Publication":"Add New Publication",visible:P,style:{width:"50%"},onHide:()=>{m(!1),s.clearValues(),t.clearValues(),v()},children:y?o("form",{onSubmit:t.handleSubmit,children:[e("div",{className:"s__row",children:e("div",{className:"s__col c--12",children:e(n,{label:"Title",name:"title",errors:t.errors,children:e(u,{name:"title",value:t.state.title,onBlur:t.handleBlur,onChange:t.handleChange})})})}),e("div",{className:"s__row",children:e("div",{className:"s__col c--12",children:e(n,{label:"Description",name:"description",errors:t.errors,children:e(w,{rows:5,cols:30,autoResize:!0,name:"description",value:t.state.description,onBlur:t.handleBlur,onChange:t.handleChange})})})}),o("div",{className:"s__row",children:[e("div",{className:"s__col c--6",children:e(n,{label:"Image",name:"image",errors:t.errors,children:e(u,{type:"file",accept:"image/*",name:"image",onChange:t.handleChange})})}),e("div",{className:"s__col c--6",children:e(n,{label:"PDF File",name:"pdf",errors:t.errors,children:e(u,{type:"file",accept:"application/pdf",name:"pdf",onChange:t.handleChange})})})]}),e("div",{className:"s__row",children:e("div",{className:"s__col c--12",children:e(n,{label:"Published Date",name:"published_date",errors:t.errors,children:e(C,{name:"published_date",value:t.state.published_date,onBlur:t.handleBlur,onChange:t.handleChange})})})}),e("div",{className:"flex justify-end mt-6",children:e(p,{type:"submit",label:"Add",loading:t.isSubmitting,disabled:t.isSubmitting})})]}):o("form",{onSubmit:s.handleSubmit,children:[e("div",{className:"s__row",children:e("div",{className:"s__col c--12",children:e(n,{label:"Title",name:"title",errors:s.errors,children:e(u,{name:"title",value:s.state.title,onBlur:s.handleBlur,onChange:s.handleChange})})})}),e("div",{className:"s__row",children:e("div",{className:"s__col c--12",children:e(n,{label:"Description",name:"description",errors:s.errors,children:e(w,{rows:5,cols:30,autoResize:!0,name:"description",value:s.state.description,onBlur:s.handleBlur,onChange:s.handleChange})})})}),o("div",{className:"s__row",children:[e("div",{className:"s__col c--6",children:e(n,{label:"Image",name:"image",errors:s.errors,children:e(u,{type:"file",accept:"image/*",name:"image",onChange:s.handleChange})})}),e("div",{className:"s__col c--6",children:e(n,{label:"PDF File",name:"pdf",errors:s.errors,children:e(u,{type:"file",accept:"application/pdf",name:"pdf",onChange:s.handleChange})})})]}),e("div",{className:"s__row",children:e("div",{className:"s__col c--12",children:e(n,{label:"Published Date",name:"published_date",errors:s.errors,children:e(C,{name:"published_date",value:s.state.published_date,onBlur:s.handleBlur,onChange:s.handleChange})})})}),e("div",{className:"flex justify-end mt-6",children:e(p,{type:"submit",label:"Add",loading:s.isSubmitting,disabled:s.isSubmitting})})]})})]})};export{te as default};
